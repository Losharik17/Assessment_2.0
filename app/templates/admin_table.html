{% extends "base.html"%}

{%  block app_content %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <div>
        <table class="table_sort">
            <thead>
            <tr>
                <th id="id" onclick="sort('id')">№</th>
                <th id="username" onclick="sort('#username')">Участник</th>
                <th id="birthday" onclick="sort('#birthday')">Дата рождения</th>
                <th id="team" onclick="sort('#team')">Команда</th>
                {% set j = 0 %}
                {% for parameter in ParName %}
                <th id="sum_grade_{{ j }}" onclick="sort('#sum_grade_{{ j }}')">{{ parameter.name }}</th>
                    {% set j = j + 1%}
                {% endfor %}
                <th id="sum_grade_all" onclick="sort('#sum_grade_all')">Общая оценка</th>
            </tr>
            </thead>

            <tbody>
            {% set j = 0 %}
            {% for user in users %}
                <tr id="number_str{{ j }}">

                    <td id="id{{ j }}">
                        {% if user.id %}
                            {{ user.id }}
                        {% else %}
                            –
                        {% endif %}
                    </td>

                    <td id="username{{ j }}">
                        {% if user.username %}
                            {{ user.username }}
                        {% else %}
                            –
                        {% endif %}
                    </td>

                    <td id="birthday{{ j }}">
                        {% if user.birth_date %}
                            {{ user.birthday }}
                        {% else %}
                            –
                        {% endif %}
                    </td>

                    <td id="team{{ j }}">
                        {% if user.team %}
                            {{ user.team }}
                        {% else %}
                            –
                        {% endif %}
                    </td>


                    {% for i in range(10) %}
                        {% if user.__dict__['sum_grade_{}'.format(i)] %}
                            <td id="'sum_grade_{{ i }}_{{ j }}">
                                {% if user.__dict__['sum_grade_{}'.format(i)] == 0 %}
                                    —
                                {% else %}
                                    {{ user.__dict__['sum_grade_{}'.format(i)] }}
                                {% endif %}
                            </td>
                        {% endif %}
                    {% endfor %}

                    <td id="sum_grade_all_{{ j }}">
                        {% if user.sum_grade_all == 0 %}
                            —
                        {% else %}
                            {{ user.sum_grade_all }}
                        {% endif %}
                    </td>

                </tr>

                {% set j = j + 1 %}

            {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="test"></div>

    <script>

        function sort(parameter) {

            $.post('/sort_users_table', {
                par: parameter
            }).done(function (response) {
                let u = JSON.parse(response['users'])
                $(parameter).html(u.id)
            }).fail(function () {
                $(parameter).text("Error")
            })

        }

    </script>



{% endblock %}
