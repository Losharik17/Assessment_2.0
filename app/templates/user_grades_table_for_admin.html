{% extends "main_0.html" %}


{%  block app_content %}
    {% if user is defined %}
        <link rel="stylesheet"  href="{{ url_for('static', filename='admin_table.css')}}">
        <link rel="stylesheet"  href="{{ url_for('static', filename='user_grades_table.css')}}">
        <script src="{{ url_for('static', filename='user_grades_table_for_admin.js') }}"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/3.3.4/jquery.inputmask.bundle.min.js"></script>


        <div class="container">
            <div class="data">
                <img id="img" style="width: 100px; height: 150px" alt="">
                <table id="data_table" style="margin: 10px;" class="data_table">
                    <tr>
                        <td style="text-align: left">ID: <span>{{ user.project_id }}</span></td>
                    </tr>
                    <tr>
                        <td style="text-align: left">ФИО: <span>{{ user.username }}</span></td>
                    </tr>
                    <tr>
                        <td style="text-align: left" id="birthday">Возраст: <span></span></td>
                    </tr>
                    <tr>
                        <td style="text-align: left">Команда:
                            <span>{% if user.team %}{{ user.team }}{% else %} – {% endif %}</span></td>
                    </tr>
                    <tr>
                        <td style="text-align: left">Регион:
                            <span>{% if user.region %}{{ user.region }}{% else %} – {% endif %}</span></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="edit_data" class="button_re" onclick="
                edit_data({{ user.id }}, `{{ user.birthday.strftime('%d.%m.%Y') }}`)">Редактировать данные
        </div>
        <div id="edit_data" class="button_re" onclick="delete_user({{ user.id }}, {{ user.project_id }}, {{ user.project_number }})">
            Удалить участника
        </div>
        <input type="submit" name="submit" id="submit" style="visibility: hidden">

        <div class="table-wrap">
            <table class="table-sort">
                <thead>
                <tr>
                    <th id="expertname" class="th_clean">Эксперт</th>
                    <th id="date" class="sort" data-order="0" onclick="sort(this.id, {{ user_id }})">Время</th>
                    {%set k = namespace(a=0) %}
                    {% for parameter in ParName %}
                        <th id="parameter{{ k.a }}" class="th_clean">{{ parameter.name }}</th>
                        {% set k.a = k.a + 1 %}
                    {% endfor %}
                    <th id="comment" class=" th_clean">Комментарий</th>
                </tr>
                </thead>

                <tbody id="tbody">

                </tbody>
            </table>

            <div class="show">
                <a id="show_more" class="show_btn" href="javascript:show_more(10, {{ user_id }})">
                    Показать больше</a>
                <a id="show_all" class="show_btn" href="javascript:show_more(10000, {{ user_id }})">
                    Показать все</a>
            </div>
        </div>

        <script>
            $('#birthday').children('span').append(Math.floor((new Date() - new Date(`{{ user.birthday }}`))
                / (24 * 3600 * 365.25 * 1000)))
            show_more(0, {{ user_id }})

            // костыль
            let src = {{ user.photo }}
            if (src.find('http')) {
                src = src.substr(0, 25) + 'uc' + src.substr(29)
                $('#img').attr('src', src)
            }

        </script>
    {% else %}
        <h3>Пользователя не существует или мы не смогли его найти</h3>
    {% endif %}

{% endblock %}
